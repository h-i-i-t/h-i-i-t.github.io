{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/20220306/.envがGithub Actionsで使えない",
    "result": {"data":{"site":{"siteMetadata":{"title":"hi1t0","siteUrl":"https://hi1t0.com"}},"markdownRemark":{"id":"23cccb7a-402b-50a0-a05f-a566ac25eaff","fields":{"slug":"/20220306/"},"excerpt":"Gatsby の公式サイトを見るとでプロジェクトを立ち上げると変数は.env.development、の時は.env.production が適応される Environment Variables gatsby-config.js で使用する場合、先頭に以下の文を含める src フォルダ以下の js…","html":"<p>Gatsby の公式サイトを見ると<code class=\"language-text\">gatsby develop</code>でプロジェクトを立ち上げると変数は.env.development、<code class=\"language-text\">gatsby build</code>の時は.env.production が適応される</p>\n<p><a href=\"https://www.gatsbyjs.com/docs/how-to/local-development/environment-variables/\">Environment Variables</a></p>\n<p>gatsby-config.js で使用する場合、先頭に以下の文を含める</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"dotenv\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.env.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NODE_ENV</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">siteMetadata</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span></code></pre></div>\n<p>src フォルダ以下の js ファイルでは<code class=\"language-text\">require(\"dotenv\")</code>をする必要はない</p>\n<p>デフォルトでは、環境変数は Node.js コードでのみ使用可能であり、ブラウザーでは使用できません。一部の変数は秘密にして、サイトにアクセスする人に公開しないようにする必要があるためブラウザで変数を公開するには、その名前の前に GATSBY_を付ける必要があります。 したがって、</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token constant\">GOOGLE_ANALYTICS_TRACKING_ID</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"G-WVTLJLZHVS\"</span>\n<span class=\"token constant\">GATSBY_API_ENDPOINT</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"https://xxx.com\"</span></code></pre></div>\n<p>の場合\nGATSBY_API_ENDPOINT はブラウザコードで使用できますが、GOOGLE_ANALYTICS_TRACKING_ID は使用できない</p>\n<p>.env.development と.env.production を設定し git push したところ変数が代入されていなかった</p>\n<p>調べたところ Github Actions で変数を扱いたい場合プロジェクトの Settings → Secrets → Actions を選択\nNew repository secret をクリックして、変数のペアを入力する</p>\n<div style=\"width: 100%; margin-left: auto; margin-right: auto\">\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7aca499c5dfffbd34b5dfc25550f9a45/42b11/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.06329113924051%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABm0lEQVQoz31SWa4cMQjs+58zeb17t/FeEfT0KPkJUgnbCFwULNZHMIwL4i9lvncXErT137syDs5H8Upp7NuOXCpK6yi1g0rDAgBEGa01/G0xRhhjYIzF/4xzlTbQxqG2hmXOiRCjXNjGnOKZwc/PinXbYJ1DCAHWOngfBNoYyXPOQ2sjb2OMpyAnr+smrNj4zXuPWykorSXBWitnZvzAwLgInyp671KM86RlTrhvhVqrPLKFSNgvhVvbR6M2xOf6nj/oE7k2pFzRemeGgLEWKdGXHYODpVRpbd12nNeF4zhxXbfIcJ4X9uOQWC4FfQyMMbGwZsyO23vZvUWZMevEgvNkj0vh93bg17rLNvAGGOuQiGSo0vL8FGSGrEXv41vwtTGBWBgTngZCHnKn+u/EHw3nlOmx4DzJUooEa20gKrJn3P7oQ4RnvENg31pH6wP1E1/amLhuJUVf7TjgQsR6nDiVRqD8AYFKlQWOlBGpCELKiJGeofQB0YGXkx+YGfvWG2JJ8DnAUYAn9h5tdPk4piRLnfijEFFCFIZ/AOC+V1u6Sf2SAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test\"\n        title=\"test\"\n        src=\"/static/7aca499c5dfffbd34b5dfc25550f9a45/f058b/2.png\"\n        srcset=\"/static/7aca499c5dfffbd34b5dfc25550f9a45/c26ae/2.png 158w,\n/static/7aca499c5dfffbd34b5dfc25550f9a45/6bdcf/2.png 315w,\n/static/7aca499c5dfffbd34b5dfc25550f9a45/f058b/2.png 630w,\n/static/7aca499c5dfffbd34b5dfc25550f9a45/40601/2.png 945w,\n/static/7aca499c5dfffbd34b5dfc25550f9a45/78612/2.png 1260w,\n/static/7aca499c5dfffbd34b5dfc25550f9a45/42b11/2.png 2364w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n</div>\n<p>登録した変数を使用する時は、<code class=\"language-text\">${{ secrets.変数 }}</code></p>\n<p>.github/workflows/gh-pages.yml を以下のように変更する</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">  - name: Build\n    run: <span class=\"token function\">npm</span> run build\n    env:\n      GOOGLE_ANALYTICS_TRACKING_ID: <span class=\"token variable\">${{ secrets.GOOGLE_ANALYTICS_TRACKING_ID }</span><span class=\"token punctuation\">}</span>\n      NODE_ENV: <span class=\"token string\">\"production\"</span></code></pre></div>\n<p>これで<code class=\"language-text\">process.env.GOOGLE_ANALYTICS_TRACKING_ID</code>で変数の値にアクセスできるようになる</p>\n<p><a href=\"https://stackoverflow.com/questions/64109619/using-environment-variables-in-gatsby-site-deployed-on-github-pages\">Using environment variables in Gatsby site deployed on GitHub pages</a></p>\n<p><a href=\"https://www.raulmelo.dev/blog/cache-gatsby-github-actions\">Gatsby Incremental Builds and Github Actions</a></p>","frontmatter":{"title":".envがGithub Actionsで使えない","date":"March 06, 2022","description":null,"tags":["Github",".env","Gatsby"]},"tableOfContents":""},"previous":{"fields":{"slug":"/20220304/"},"frontmatter":{"title":"Github Actionsでnpm ciがうまく通らなかった"}},"next":{"fields":{"slug":"/20220308/"},"frontmatter":{"title":"Gatsbyjsのプロジェクトでサイトマップ出力"}}},"pageContext":{"id":"23cccb7a-402b-50a0-a05f-a566ac25eaff","previousPostId":"3820e968-0f5d-54ac-a3d7-17dd220abb8e","nextPostId":"4695f937-35b6-5b5a-be19-5b92eff66c85"}},
    "staticQueryHashes": ["2841359383","3257411868"]}